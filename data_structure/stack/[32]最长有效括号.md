# [32. 最长有效括号](https://leetcode.cn/problems/longest-valid-parentheses)

## 思路

核心思想

- 用栈保存 下标
- 栈底放一个 哨兵 -1，用于计算长度

遇到：

- '(' → 入栈
- ')' → 出栈

如果栈空，说明当前 ) 无法匹配，压入当前下标作为**新的起点**

否则，当前合法长度 = i - 栈顶

- 为什么要放 -1？

为了在从 0 开始就合法时，长度计算正确。

## 解法

### 栈

> - 栈存下标，先压 -1； 
> - 遇 '(' 入栈，遇 ')' 出栈； 
> - 出栈后空 → 压当前下标； 
> - 不空 → 用 i - 栈顶 更新答案

```java
class Solution {
    public int longestValidParentheses(String s) {
        Stack<Integer> st = new Stack<>();
        int ans = 0;

        // 哨兵
        st.push(-1);

        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == '(') {
                st.push(i);
            } else {
                st.pop();
                if (st.isEmpty()) {
                    // 为空，说明当前 ')' 无法匹配
                    st.push(i);
                } else {
                    // 不为空，计算合法长度，更新答案
                    ans = Math.max(ans, i - st.peek());
                }
            }
        }
        return ans;
    }
}
```